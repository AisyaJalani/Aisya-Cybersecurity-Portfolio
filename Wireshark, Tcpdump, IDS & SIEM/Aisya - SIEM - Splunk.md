# Perform query - Splunk

## Scenario

You are a security analyst working at the e-commerce store Buttercup Games. You've been tasked with identifying whether there are any possible security issues with the mail server. To do so, you must explore any failed SSH logins for the root account. 

## Overview

SIEM tools like Splunk are critical for security analysts, providing a platform to store, analyze, and report on diverse security data. Using Splunk's Search Processing Language (SPL), you can perform effective searches with pipes and wildcards to quickly and accurately identify information. This skill is crucial for rapid incident response and efficiently recognizing patterns, trends, and anomalies within large datasets.

Using Splunk, you will able to achieve:
* Upload sample log data 
* Search through indexed data
* Evaluate search results
* Identify different data sources 
* Locate failed SSH login(s) for the root account
<br/>

**1. Upload sample log data**

* Login/signup to Splunk Cloud account.
* Add and upload data `tutorialdata.zip` into Splunk.

![AD_4nXcWO8ZXhI1wItKt9YJFlWjxkWGp1QaMtrUv2b-LaveIbD2cKeA2pMGACaixpdAI7YgJkzlVzNyx4MVSVw2IqRa0pxvxxil_ODNJptKGCt4j8vCnS2Uy2VgH](https://github.com/user-attachments/assets/95a20019-aa8e-4405-a7ad-f7a98b873fdc) 
<br/>  

**2. Search through indexed data**

* In the search bar,  enter the search query: `index=main`. This search term specifies the index. An index is a repository for data.

* Change to **All Time** from the time range dropdown to search for all the events across all time. The search will retrieve thousands of events.

![AD_4nXcWXNLBoiWk01MMwpMFRznRwt4tHC1VBP1yPtvYAEKXx9UmCNboaNUhcawzteIr0pltILLL23wvF9FH5rwmV5-Cw4jSncDJf5UmHVz7o2SYvEJv9YmAhjpI](https://github.com/user-attachments/assets/2b340598-dc1f-42d6-8023-b2b906164f70) <br/>

![AD_4nXdTyaJnTt7-Lvbh8RJofTZh3mzWOEeVpjAoFgc_Od6h749IJSnK22VcjsAQ4evZy5DPTdyrDhjKXukdAfwbjbl92jgRHrrm-7DEYNsrnmS6oqkyXMwJ5Ba5](https://github.com/user-attachments/assets/13d24ac4-0398-440d-9bea-6bb2f80286d0) <br/>
<br/>  

**3. Evaluate search results**

* When Splunk indexes data, it attaches fields to each event. These fields become part of the searchable index event data. This helps security analysts easily search for and find the specific data they need. Now that you've run your first query, examine the search results and the fields.

* For each event the fields are `host`, `source`, and `sourcetype`. Under **SELECTED FIELDS**, examine the same fields.

![AD_4nXdJaDQloEbUVGqBNgOCYMl1Bbnafwo6egTSC2LEZ07GWBiCWlfxoyqpLNY-GNgIFzrjvjKBATmKb9hlSVO7L3GPRlNFVNnL5wqaITlIDNAgsKOZtodUj-tN](https://github.com/user-attachments/assets/abbd4e27-cb0a-46eb-b145-207308d88a03) <br/>

Examine the field values by clicking on the field under SELECTED FIELDS. You should observe the following:
* **host:** The host field specifies the name of the network host from which the event originated. In this search there are five hosts:
  * `mailsv` - Buttercup Games' mail server. Examine events generated from this host.
  * `www1` - This is one of Buttercup Games' web applications.
  * `www2` - This is one of Buttercup Games' web applications.
  * `www3` - This is one of Buttercup Games' web applications.
  * `vendor_sales` - Information about Buttercup Games' retail sales.

![AD_4nXd15rT7kX8bkPluHjgBx5LCPFkiqVvpOPaPAQdkgMd-Irecx7cKqaxpCzL35HCYh1AMJ5U0xSktXcp_geLC-_cEx4PPaQhSMRgylcZkUNz21WeIcqKySxYJ](https://github.com/user-attachments/assets/c5c3c446-6c82-4d84-868b-ce65f22762a1)
<br/>

* **source**: The source field indicates the file name from which the event originates. You should identify eight sources. Notice `/mailsv/secure.log`, which is a log file that contains information related to authentication and authorization attempts on the mail server.

![AD_4nXdGMzI3ZA_Ch7JN_2-8M9Kqk3wbJLv3MHyHKZ0En7mZR2McRzIQKSi0aBtnrpQy9Hqv8Ft67sXVIvszowtPV9lP4-Nt3ljTmwnDo57qO6ldObbDpCIntjKy](https://github.com/user-attachments/assets/b258eb56-e0d1-41c3-9dd9-d359aab0cd74)
<br/>

* **sourcetype**: The sourcetype determines how data is formatted. You should observe three sourcetypes. Examine `secure-2`.
<br/>

**4. Identify different data sources**

* On the mail server, we need to narrow the search results for events from the mail server. I enter `index=main host=mailsv` in the search bar. The search results have narrowed to over 9000 events that are generated by the mail server.

![AD_4nXdprHjon-gCyyqVTt_Y3-m2axcT1aOzsXPlFms4hEuPJVbEsCebpSUo7dUGinzXDV0jBwv131sEJExgpOocR5KpLypgxV5IPj7oQchoLMJ6IGxYzL7328mX](https://github.com/user-attachments/assets/171e19f9-090a-45c7-8494-620f623ebc7b)
<br/>

**4. Locate failed SSH login(s) for the root account**

* Enter `index=main host=mailsv fail* root` into the search bar. This search will expands on the search for the keyword `fail*`. The wildcard tells Splunk to expand the search term to find other terms that contain the word _fail_ such as _failure_, _failed_, etc. 
* The keyword `root` searches for any event that contains the term root.

![AD_4nXcn5LqTJBbUp2mTIT1PpTyBYnHhodo-obMQIf_OA1lhvtEUVmL2cAG0QlLTNvTFQLtbyAKe4Q-H0CUE2gQAOLq0ddHCtlGa2kDUX-jUK3D734ffJt-bjyq2](https://github.com/user-attachments/assets/8fb18608-630d-4777-b021-f79b0bff451e)
<br/>

**5. Evaluation**

* There are over 100,000 events contained in the main index across all time.
* The `host` field specifies the name of a host, such as network device or system from which an event originates.
* The `vendor_sales` host provides information about Buttercup Gamesâ€™ retail sales, such as the number of products sold.
* There are over 100 failed SSH logins for the root account on the mail server.



