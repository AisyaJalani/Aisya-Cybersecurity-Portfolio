# Explore signature with Suricata

## Scenario

In this scenario, you’re a security analyst who must monitor traffic on your employer's network. You’ll be required to configure Suricata and use it to trigger alerts.

You will have practical experience in running Suricata to:
* Create custom rules and run them in Suricata
* Monitor traffic captured in a packet capture file
* Examine the `fast.log` and `eve.json` output

Let’s define the files:

* The `sample.pcap` file is a packet capture file that contains an example of network traffic data, which you’ll use to test the Suricata rules. This will allow you to simulate and repeat the exercise of monitoring network traffic.

* The `custom.rules` file contains a custom rule when the lab activity starts. You’ll add rules to this file and run them against the network traffic data in the `sample.pcap` file.

* The `fast.log` file will contain the alerts that Suricata generates. The `fast.log` file is empty when the lab starts. Each time you test a rule, or set of rules, against the sample network traffic data, Suricata adds a new alert line to the `fast.log` file when all the conditions in any of the rules are met. The `fast.log` file can be located in the `/var/log/suricata` directory after Suricata runs.The `fast.log` file is considered to be a depreciated format and is not recommended for incident response or threat hunting tasks but can be used to perform quick checks or tasks related to quality assurance.

* The `eve.json` file is the main, standard, and default log for events generated by Suricata. It contains detailed information about alerts triggered, as well as other network telemetry events, in JSON format. The `eve.json` file is generated when Suricate runs, and can also be located in the `/var/log/suricata` directory.

When you create a new rule, you'll need to test the rule to confirm whether or not it worked as expected. You can use the `fast.log` file to quickly compare the number of alerts generated each time you run Suricata to test a signature against the `sample.pcap` file.

**1. Examine a custom rule in Suricata**

* The `cat` command used to display the rule in the `custom.rules` files.

<img width="744" alt="AD_4nXcwmkkXzgoWvesKTTsj9WX41eFN-fUMejL1lOtmunpKP2uXdRGAx50SJD-roPBYZbsDOwWdL8OGqkzO98UcHrlPy-SAjjfy0_-c6YPhlyxjiDE21qHn_NDA" src="https://github.com/user-attachments/assets/c2a3e6e1-728e-438f-b951-9277ba9f7d64" />

* The signature shows `action` = `alert` which instructs to alert on selected network traffic. `Header` = `http`, and `rule options` = `(msg:"GET on wire"; flow:established,to_server; content:"GET"; http_method; sid:12345; rev:3;)`  
* The output shows a signature that triggers an alert whenever Suricata observes the text `GET` as the HTTP method in an HTTP packet from the home network going to the external network. <br/>

**2. Trigger a custom rule in Suricata**

* I used `ls -l` to list the files in the `/var/log/suricata` folder.
* The command `sudo suricata -r sample.pcap -S custom.rules -k none` is used to start the Suricata application and processes the `sample.pcap` file using the rules in the `custom.rules` file. It returns an output stating how many packets were processed by Suricata.
* The command `cat` is used to display the `fast.log` file generated by Suricata and the output returns alert entries in the log. <br/>

![AD_4nXc2SOwI2smTtyFmDITj-u3Ua5pybAgEZXyLnW7kvta_R2Sp_ap9BurGsNRLkaP6VOwrQXYd7HQFMDlOYDcxULqthL2Q0a9tX-uNr9njqoc492Jml2nkE91A](https://github.com/user-attachments/assets/2f06f944-7dd2-41bf-97a6-ea7edd5879b2) <br/>

**3. Examine eve.json output**

* I used the command `cat` to display the `eve.json` file. The output shows the raw content of the file.

![AD_4nXfeWijIwHzC19LqfiOZQ-ifz4FGVxeQhUsjV4982nx6w0_8fgISZfxpVb8_2itKrdGRALtXEcMRpbTXuallWIH-Zuxz454LmWOpeRppMmIGycvA40Z4bIjS](https://github.com/user-attachments/assets/aed6e7b6-f22b-46cb-bcf0-35c779d2b36d) <br/>

* I used the command `jq` command to display entries in an improved format.

<img width="575" alt="AD_4nXeN52jXP5jNsriinsUhEOXURU3vj-litMnJUZ0vRK2pTIalRnTUHfPteMu52qoK8ODNwS3Bfh6e4nolW8GK6WQ9mBItrtAfT1vjpZPXuTwQGWiDreJkzSgX" src="https://github.com/user-attachments/assets/009f6cae-8705-489d-aeeb-6a65874f20d1" /> <br/>

* I used the command `jq` to extract specific event data from the `eve.json` file.
* The command `jq` is to display all event logs related to a specific `flow_id` from the `eve.json` file. Suricata assigns a unique `flow_id` to each network flow. All logs from a network flow share the same `flow_id` which is a useful field for correlating network traffic that belongs to the same network flows.

![AD_4nXcCcHSiGLEwHqN-prU-IzwddnTcGiFBPeKT4oggRekhKbK2r4a3mqf__VJvOIZ1ZwmD9MVD6FFoJeraaM8DZXGTCxagNMM_NMec7k0kwqMMkY5YnUVhcL2R](https://github.com/user-attachments/assets/f951e3c2-f224-4d91-a0ce-beecbddc848b) <br/>




